<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>FPPT-03 Forms</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>
    <style>
      @media print {
        body {
          -webkit-print-color-adjust: exact;
          print-color-adjust: exact;
        }
        #form-container {
          font-size: 10px;
          line-height: 1.2;
        }
      }
    </style>
  </head>

  <body class="bg-gray-100 min-h-screen flex justify-center items-start p-8 overflow-auto">
    <div class="w-full max-w-4xl bg-white shadow-lg p-6">
      <button id="download-pdf" class="mb-4 px-4 py-2 bg-blue-500 text-white rounded">Download as PDF</button>
      <div id="form-container" class="w-full space-y-8 text-xs leading-tight">
        <!-- Dynamic content will be added here -->
      </div>
    </div>

    <!-- Linking the fetch_google_sheets.js file -->
    <!-- <script src="lembur-lembar.js"></script> -->

    <script>
      document.getElementById('download-pdf').addEventListener('click', function () {
        const element = document.getElementById('form-container');

        const opt = {
          margin: [5, 5, 5, 5],
          filename: 'FPPT-03-Forms.pdf',
          image: { type: 'jpeg', quality: 0.98 },
          html2canvas: { scale: 1, useCORS: true },
          jsPDF: { unit: 'mm', format: 'legal', orientation: 'portrait' },
        };

        html2pdf().from(element).set(opt).save();
      });

      document.addEventListener('DOMContentLoaded', async function () {
        try {
          const response = await fetch('https://rj.up.railway.app/api/google-sheets/lembur-lembar/');
          if (!response.ok) {
            throw new Error('Failed to fetch data');
          }
          const rawData = await response.json();
          const transformedData = rawData.data.slice(1).map((item) => ({
            namaDriver: item[2],
            tanggalMulai: new Date(item[5]).toLocaleDateString('id-ID', {
              day: '2-digit',
              month: 'long',
              year: 'numeric',
            }),
            hariMulai: item[6],
            jamMulai: item[10],
            tanggalSelesai: new Date(item[7]).toLocaleDateString('id-ID', {
              day: '2-digit',
              month: 'long',
              year: 'numeric',
            }),
            hariSelesai: item[8],
            jamSelesai: item[11],
            durasiLembur: item[12],
            kegiatanLembur: item[4],
            namaForm1: item[16],
            JabatanForm1: item[17],
            namaForm2: item[18],
            jabatanForm2: item[19],
            kota: item[20],
            bulanLembur: new Date(item[5]).toLocaleString('id-ID', { month: 'long' }),
            bulanTagihan: 'should be next month after bulanLembur'
          }));

          const container = document.getElementById('form-container');
          container.innerHTML = '';

          transformedData.forEach((record, index) => {
    const recipients = [
        'Direksi Lapangan',
        'Pimpinan/ Koordinator/ Penanggungjawab',
        `Sdr. ${record.namaDriver}`,
    ];
    const openingTexts = [
        'Sehubungan dengan adanya kegiatan yang perlu dilakukan di luar jam kerja, dimohon kerjasamanya untuk menugaskan pihak terkait.',
        'Mengacu pada perjanjian kerja dan adanya kebutuhan layanan tambahan di luar jam kerja, dimohon kerjasamanya dalam pelaksanaan kegiatan ini.',
        'Anda ditugaskan untuk melaksanakan pekerjaan tambahan sesuai dengan kesepakatan yang telah ditentukan dalam perjanjian kerja.',
    ];
    const signatories = [
        ['Manager UPT Banda Aceh'],
        ['Pimpinan PT PLN (PERSERO)'],
        ['Pimpinan UPT Banda Aceh', 'Pengawas Lapangan'],
    ];

    const forms = ['Form FPPT-01', 'Form FPPT-02', 'Form FPPT-03'];

    forms.forEach((formTitle, formIndex) => {
        const formElement = `
        <table class="w-full border-2 border-black bg-white rounded-lg shadow-lg p-4 mb-4 text-xs border-collapse">
            <!-- Header Section -->
            <tr>
                <td colspan="5" class="border-b border-black pb-2 mb-2 w-full">
                    <div class="flex justify-between items-start w-full">
                        <div>
                            <p class="text-xs font-medium">PT PLN (PERSERO)</p>
                            <p class="text-xs text-gray-500">UPT Banda Aceh</p>
                        </div>
                        <div class="text-xs font-medium border border-black px-2 py-1">${formTitle}</div>
                    </div>
                </td>
            </tr>
            <tr>
                <td colspan="5" class="text-sm font-bold text-center mb-4 w-full">${formTitle}</td>
            </tr>
            <tr>
                <td colspan="5" class="text-xs mb-1 leading-tight w-full">
                    <p>Kepada Yth.</p>
                    <p class="italic">${recipients[formIndex]}</p>
                    <p>${openingTexts[formIndex]}</p>
                </td>
            </tr>

            <!-- Nested Table for Data Rows -->
            <tr>
                <td colspan="5">
                    <table class="w-auto border-collapse border border-white">
                        <tr>
                            <td class="px-2 py-1 w-auto">1</td>
                            <td class="px-2 py-1 w-auto">Hari, Tanggal Mulai</td>
                            <td class="px-2 py-1 w-auto">:</td>
                            <td class="px-2 py-1 w-auto">${record.hariMulai}, ${record.tanggalMulai}</td>
                            <td class="px-2 py-1 w-auto"></td>
                        </tr>
                        <tr>
                            <td class="px-2 py-1 w-auto">2</td>
                            <td class="px-2 py-1 w-auto">s/d Hari, Tanggal Akhir</td>
                            <td class="px-2 py-1 w-auto">:</td>
                            <td class="px-2 py-1 w-auto">${record.hariSelesai}, ${record.tanggalSelesai}</td>
                            <td class="px-2 py-1 w-auto"></td>
                        </tr>
                        <tr>
                            <td class="px-2 py-1 w-auto">3</td>
                            <td class="px-2 py-1 w-auto">Waktu</td>
                            <td class="px-2 py-1 w-auto">:</td>
                            <td class="px-2 py-1 w-auto">${record.jamMulai} s/d ${record.jamSelesai}</td>
                            <td class="px-2 py-1 w-auto"></td>
                        </tr>
                        <tr>
                            <td class="px-2 py-1 w-auto">4</td>
                            <td class="px-2 py-1 w-auto">Durasi</td>
                            <td class="px-2 py-1 w-auto">:</td>
                            <td class="px-2 py-1 w-auto">${record.durasiLembur} Jam</td>
                            <td class="px-2 py-1 w-auto"></td>
                        </tr>
                        <tr>
                            <td class="px-2 py-1 w-auto">5</td>
                            <td class="px-2 py-1 w-auto">Kegiatan</td>
                            <td class="px-2 py-1 w-auto">:</td>
                            <td class="px-2 py-1 w-auto">${record.kegiatanLembur}</td>
                            <td class="px-2 py-1 w-auto"></td>
                        </tr>
                    </table>
                </td>
            </tr>

            <!-- Closing Text -->
            <tr>
                <td colspan="5" class="text-sm mt-6 text-left p-2 w-full">
                    Demikian dan terima kasih atas kerjasamanya.
                </td>
            </tr>

            <!-- Signature Section in Main Table -->
<tfoot>
${
    formIndex < 2
        ? `
        <tr>
            <td colspan="5" class="border px-2 py-4">
                <div class="grid grid-cols-4 w-full">
                    <div></div>
                    <div></div>
                    <div></div>
                    <div class="text-center">${record.kota}, ${record.bulanLembur} 2024<br>Pemohon,<br>${record.JabatanForm1}<br><br><br>${record.namaForm1}</div>
                </div>
            </td>
        </tr>`
        : `
        <tr>
            <td colspan="5" class="border px-2 py-4">
                <div class="grid grid-cols-4 w-full">
                    <div class="text-center">Pemohon,<br><br>${record.JabatanForm1}<br><br><br>${record.namaForm1}</div>
                    <div></div>
                    <div></div>
                    <div class="text-center">${signatories[formIndex][1]}</div>
                </div>
            </td>
        </tr>`
}
</tfoot>

        </table>`;

        container.innerHTML += formElement;
    });
});

        } catch (error) {
          console.error('Error fetching data:', error);
        }
      });
    </script>
  </body>
</html>
